---
/**
 * Status Page Preview/Demo
 *
 * This page provides a preview of the status page layout with mock data.
 * Useful for local development and testing without subdomain routing.
 *
 * Access via: http://localhost:4321/status-preview
 *
 * Query params:
 * - status: "none" | "minor" | "major" | "critical" | "maintenance"
 *   Example: /status-preview?status=minor
 */
import StatusPageLayout from "@/layouts/StatusPageLayout.astro";
import type { PageStatusIndicator } from "@/db/schema/constants";
import { PAGE_STATUS_INDICATORS } from "@/db/schema/constants";

// Get status from query param, default to "none" (operational)
const url = new URL(Astro.request.url);
const statusParam = url.searchParams.get("status") || "none";

// Validate status param
const statusIndicator: PageStatusIndicator = PAGE_STATUS_INDICATORS.includes(
	statusParam as PageStatusIndicator
)
	? (statusParam as PageStatusIndicator)
	: "none";

// Mock page data for demo
const mockPage = {
	name: "Acme Corp",
	statusIndicator,
	statusDescription: null as string | null,
};
---

<StatusPageLayout
	pageName={mockPage.name}
	statusIndicator={mockPage.statusIndicator}
	statusDescription={mockPage.statusDescription}
	subscribeUrl="/subscribe"
>
	<!-- Demo Controls -->
	<div class="mb-8 rounded-lg border border-dashed border-blue-300 bg-blue-50 p-4 dark:border-blue-800 dark:bg-blue-950/30">
		<p class="mb-2 text-sm font-medium text-blue-700 dark:text-blue-300">
			Preview Mode - Select Status:
		</p>
		<div class="flex flex-wrap gap-2">
			<a
				href="/status-preview?status=none"
				class:list={[
					"rounded px-3 py-1 text-sm transition-colors",
					statusIndicator === "none"
						? "bg-emerald-500 text-white"
						: "bg-white text-foreground hover:bg-gray-100 dark:bg-gray-800 dark:hover:bg-gray-700"
				]}
			>
				Operational
			</a>
			<a
				href="/status-preview?status=minor"
				class:list={[
					"rounded px-3 py-1 text-sm transition-colors",
					statusIndicator === "minor"
						? "bg-yellow-500 text-black"
						: "bg-white text-foreground hover:bg-gray-100 dark:bg-gray-800 dark:hover:bg-gray-700"
				]}
			>
				Minor
			</a>
			<a
				href="/status-preview?status=major"
				class:list={[
					"rounded px-3 py-1 text-sm transition-colors",
					statusIndicator === "major"
						? "bg-orange-500 text-white"
						: "bg-white text-foreground hover:bg-gray-100 dark:bg-gray-800 dark:hover:bg-gray-700"
				]}
			>
				Major
			</a>
			<a
				href="/status-preview?status=critical"
				class:list={[
					"rounded px-3 py-1 text-sm transition-colors",
					statusIndicator === "critical"
						? "bg-red-600 text-white"
						: "bg-white text-foreground hover:bg-gray-100 dark:bg-gray-800 dark:hover:bg-gray-700"
				]}
			>
				Critical
			</a>
			<a
				href="/status-preview?status=maintenance"
				class:list={[
					"rounded px-3 py-1 text-sm transition-colors",
					statusIndicator === "maintenance"
						? "bg-blue-500 text-white"
						: "bg-white text-foreground hover:bg-gray-100 dark:bg-gray-800 dark:hover:bg-gray-700"
				]}
			>
				Maintenance
			</a>
		</div>
	</div>

	<!-- Mock Component Status -->
	<section class="space-y-6">
		<div class="rounded-lg border border-border bg-card p-6 shadow-sm">
			<h2 class="mb-4 text-lg font-semibold text-foreground">
				System Components
			</h2>

			<!-- Mock component list -->
			<div class="space-y-3">
				<div class="flex items-center justify-between py-2 border-b border-border last:border-0">
					<span class="text-foreground">API</span>
					<div class="flex items-center gap-2">
						<span class="h-2 w-2 rounded-full bg-emerald-500"></span>
						<span class="text-sm text-muted-foreground">Operational</span>
					</div>
				</div>
				<div class="flex items-center justify-between py-2 border-b border-border last:border-0">
					<span class="text-foreground">Web Application</span>
					<div class="flex items-center gap-2">
						<span class="h-2 w-2 rounded-full bg-emerald-500"></span>
						<span class="text-sm text-muted-foreground">Operational</span>
					</div>
				</div>
				<div class="flex items-center justify-between py-2 border-b border-border last:border-0">
					<span class="text-foreground">Database</span>
					<div class="flex items-center gap-2">
						<span class="h-2 w-2 rounded-full bg-emerald-500"></span>
						<span class="text-sm text-muted-foreground">Operational</span>
					</div>
				</div>
				<div class="flex items-center justify-between py-2">
					<span class="text-foreground">CDN</span>
					<div class="flex items-center gap-2">
						<span class="h-2 w-2 rounded-full bg-emerald-500"></span>
						<span class="text-sm text-muted-foreground">Operational</span>
					</div>
				</div>
			</div>
		</div>

		<!-- Mock Active Incidents -->
		<div class="rounded-lg border border-border bg-card p-6 shadow-sm">
			<h2 class="mb-4 text-lg font-semibold text-foreground">
				Active Incidents
			</h2>
			<p class="text-muted-foreground">
				No active incidents reported.
			</p>
		</div>

		<!-- Mock Past Incidents -->
		<div class="space-y-4">
			<h2 class="text-lg font-semibold text-foreground">
				Past Incidents
			</h2>

			<div class="space-y-4">
				<div class="border-l-2 border-emerald-500 pl-4">
					<div class="flex items-center justify-between mb-1">
						<h3 class="font-medium text-foreground">Database Maintenance Completed</h3>
						<span class="text-sm text-muted-foreground">Jan 10, 2026</span>
					</div>
					<p class="text-sm text-muted-foreground">
						Scheduled database maintenance completed successfully. All systems operational.
					</p>
				</div>

				<div class="border-l-2 border-emerald-500 pl-4">
					<div class="flex items-center justify-between mb-1">
						<h3 class="font-medium text-foreground">API Latency Resolved</h3>
						<span class="text-sm text-muted-foreground">Jan 5, 2026</span>
					</div>
					<p class="text-sm text-muted-foreground">
						Increased API response times were identified and resolved. Root cause was database connection pooling.
					</p>
				</div>
			</div>
		</div>
	</section>
</StatusPageLayout>
